{"index":{"version":"0.5.12","fields":[{"name":"title","boost":10},{"name":"keywords","boost":15},{"name":"body","boost":1}],"ref":"url","documentStore":{"store":{"./":["introduct","文档内容介绍"],"docs/":["常用知识点","本目录下记录一些散乱知识点"],"docs/redisLock.html":["\"productid\"","\"productid\"//此值，应该是业务过来的某个值","#1进入关键业务逻辑，加锁","$e)","$islock","$key","$lock","$redi","$redlock","$roomid","$server","$sleeptim","$ttl","$ttl)","$ttl)))","$ttl));//ex","$ttl))方式，本方法就是setnx加了个过期时间，但是原子操作","$valu","$value)","$value,","'ex'","'room_'.$roomid;","'room_lock';","(!$redi","($islock)","($redi","($valu","(except","(redi","//为防止锁无法释放，还要设置过期时间","//分配一个随机的值针对问题3","//删除redi","//删除锁","//判断是自己的锁，再删除redi","//加锁","//如果是两次值不同，说明a请示的业务还未处理完，$key超时，b进来了，此时把$islock设置为false，一段时间后重新请求","//开始进行业务逻辑处理...","//异常处理","//执行业务代码","//睡眠，降低抢锁频率，缓解redis压力，针对问题2","//进行业务逻辑处理...","//针对问题1，使用循环","//防止提前过期，误删其它请求创建的锁","0.01],","1))","1000);","1000//此值应该取一个递增值","10001;","10;","30","6379,","6389,","6399,","=","==","=>",">del($key)",">del($key);",">expire($key,",">get($key)",">get($key))",">incr($key)>1)",">lock('my_resource_name',",">set($key,",">setnx($key,",">unlock($lock)","[","['127.0.0.1',","];","array('nx',","cache(except","catch","continue;//执行成功删除key并跳出循环","fals","final","finally{","function","key","new","public","redis发现锁失败了要怎么办？中断请求还是循环请求？2、","redis锁","redlock($servers);","return","sleep($sleeptime)//睡眠后重新请求","testredislock()","tri","try{","usleep(5000);","uuid()","value)方式，如果值不存在，则反回1,如果存在，则反回0，为避免锁不释放，仍需要设置过期时间","while(!$islock);","{","{//大于1表示，已加锁","{//未设置成功，则反回","}","主从结构，如果redis主服务器已接收到锁，但在同步从服务时崩溃，此时如何处理？","仍使用redis的set($key,","仍存在的问题redi","使用redis的incr函数，每次调用此函数时，如果反回值大于1，则表示此锁正在使用中，从而实现加锁","使用redis的set($key,","使用redis的setnx(key,","官方提供","循环请求的话，如果有一个获取了锁，其它的在去获取锁的时候，是不是容易发生抢锁的可能？","秒","第一种方式","第三种方式","第二种方式","第五种方式","第四种方式","缺点：破坏原子性操作，上锁机制，与设置过期时间，是分开的，这中间如果服务器宕机或者其它故障，会造成锁无法释放","缺点：设置的过期时间为ttl，如果ttl","要解决的问题是，避免业务逻辑中对数据重复处理。本文所有代码均为伪代码，只考虑业务逻辑","解释","针对问题1：使用循环请求，循环请求去获取锁针对问题2：针对第二个问题，在循环请求获取锁的时候，加入睡眠功能，等待几毫秒在执行循环","问题:1、"]},"length":3},"tokenStore":{"root":{"0":{"docs":{},".":{"0":{"1":{"docs":{},"]":{"docs":{},",":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.010526315789473684}}}}},"docs":{}},"docs":{}}},"1":{"0":{"0":{"0":{"1":{"docs":{},";":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}},"docs":{},")":{"docs":{},";":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}},"/":{"docs":{},"/":{"docs":{},"此":{"docs":{},"值":{"docs":{},"应":{"docs":{},"该":{"docs":{},"取":{"docs":{},"一":{"docs":{},"个":{"docs":{},"递":{"docs":{},"增":{"docs":{},"值":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}}}}}}}}}}}},"docs":{}},"docs":{},";":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}},"docs":{},")":{"docs":{},")":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}},"3":{"0":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.014035087719298246}}},"docs":{}},"6":{"3":{"7":{"9":{"docs":{},",":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}},"docs":{}},"8":{"9":{"docs":{},",":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}},"docs":{}},"9":{"9":{"docs":{},",":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}},"docs":{}},"docs":{}},"docs":{}},"docs":{},"i":{"docs":{},"n":{"docs":{},"t":{"docs":{},"r":{"docs":{},"o":{"docs":{},"d":{"docs":{},"u":{"docs":{},"c":{"docs":{},"t":{"docs":{"./":{"ref":"./","tf":10.5}}}}}}}}}}},"文":{"docs":{},"档":{"docs":{},"内":{"docs":{},"容":{"docs":{},"介":{"docs":{},"绍":{"docs":{"./":{"ref":"./","tf":0.5}}}}}}}},"常":{"docs":{},"用":{"docs":{},"知":{"docs":{},"识":{"docs":{},"点":{"docs":{"docs/":{"ref":"docs/","tf":10}}}}}}},"本":{"docs":{},"目":{"docs":{},"录":{"docs":{},"下":{"docs":{},"记":{"docs":{},"录":{"docs":{},"一":{"docs":{},"些":{"docs":{},"散":{"docs":{},"乱":{"docs":{},"知":{"docs":{},"识":{"docs":{},"点":{"docs":{"docs/":{"ref":"docs/","tf":1}}}}}}}}}}}}}}},"\"":{"docs":{},"p":{"docs":{},"r":{"docs":{},"o":{"docs":{},"d":{"docs":{},"u":{"docs":{},"c":{"docs":{},"t":{"docs":{},"i":{"docs":{},"d":{"docs":{},"\"":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.007017543859649123}},"/":{"docs":{},"/":{"docs":{},"此":{"docs":{},"值":{"docs":{},"，":{"docs":{},"应":{"docs":{},"该":{"docs":{},"是":{"docs":{},"业":{"docs":{},"务":{"docs":{},"过":{"docs":{},"来":{"docs":{},"的":{"docs":{},"某":{"docs":{},"个":{"docs":{},"值":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.007017543859649123}}}}}}}}}}}}}}}}}}}}}}}}}}}}},"#":{"1":{"docs":{},"进":{"docs":{},"入":{"docs":{},"关":{"docs":{},"键":{"docs":{},"业":{"docs":{},"务":{"docs":{},"逻":{"docs":{},"辑":{"docs":{},"，":{"docs":{},"加":{"docs":{},"锁":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.014035087719298246}}}}}}}}}}}}}},"docs":{}},"$":{"docs":{},"e":{"docs":{},")":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.017543859649122806}}}},"i":{"docs":{},"s":{"docs":{},"l":{"docs":{},"o":{"docs":{},"c":{"docs":{},"k":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.007017543859649123}}}}}}}},"k":{"docs":{},"e":{"docs":{},"y":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.017543859649122806}}}}},"l":{"docs":{},"o":{"docs":{},"c":{"docs":{},"k":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}}},"r":{"docs":{},"e":{"docs":{},"d":{"docs":{},"i":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.031578947368421054}}},"l":{"docs":{},"o":{"docs":{},"c":{"docs":{},"k":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.010526315789473684}}}}}}}},"o":{"docs":{},"o":{"docs":{},"m":{"docs":{},"i":{"docs":{},"d":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}}}}},"s":{"docs":{},"e":{"docs":{},"r":{"docs":{},"v":{"docs":{},"e":{"docs":{},"r":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}}}},"l":{"docs":{},"e":{"docs":{},"e":{"docs":{},"p":{"docs":{},"t":{"docs":{},"i":{"docs":{},"m":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}}}}}}},"t":{"docs":{},"t":{"docs":{},"l":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.017543859649122806}},")":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.007017543859649123}},")":{"docs":{},")":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.007017543859649123}}},";":{"docs":{},"/":{"docs":{},"/":{"docs":{},"e":{"docs":{},"x":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}}}},"方":{"docs":{},"式":{"docs":{},"，":{"docs":{},"本":{"docs":{},"方":{"docs":{},"法":{"docs":{},"就":{"docs":{},"是":{"docs":{},"s":{"docs":{},"e":{"docs":{},"t":{"docs":{},"n":{"docs":{},"x":{"docs":{},"加":{"docs":{},"了":{"docs":{},"个":{"docs":{},"过":{"docs":{},"期":{"docs":{},"时":{"docs":{},"间":{"docs":{},"，":{"docs":{},"但":{"docs":{},"是":{"docs":{},"原":{"docs":{},"子":{"docs":{},"操":{"docs":{},"作":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.007017543859649123}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}},"v":{"docs":{},"a":{"docs":{},"l":{"docs":{},"u":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.007017543859649123}},"e":{"docs":{},")":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.007017543859649123}}},",":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.017543859649122806}}}}}}}}},"'":{"docs":{},"e":{"docs":{},"x":{"docs":{},"'":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.017543859649122806}}}}},"r":{"docs":{},"o":{"docs":{},"o":{"docs":{},"m":{"docs":{},"_":{"docs":{},"'":{"docs":{},".":{"docs":{},"$":{"docs":{},"r":{"docs":{},"o":{"docs":{},"o":{"docs":{},"m":{"docs":{},"i":{"docs":{},"d":{"docs":{},";":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}}}}}}}}},"l":{"docs":{},"o":{"docs":{},"c":{"docs":{},"k":{"docs":{},"'":{"docs":{},";":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}}}}}}}}}}},"(":{"docs":{},"!":{"docs":{},"$":{"docs":{},"r":{"docs":{},"e":{"docs":{},"d":{"docs":{},"i":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.010526315789473684}}}}}}}},"$":{"docs":{},"i":{"docs":{},"s":{"docs":{},"l":{"docs":{},"o":{"docs":{},"c":{"docs":{},"k":{"docs":{},")":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}}}}}},"r":{"docs":{},"e":{"docs":{},"d":{"docs":{},"i":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}}},"v":{"docs":{},"a":{"docs":{},"l":{"docs":{},"u":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}}}},"e":{"docs":{},"x":{"docs":{},"c":{"docs":{},"e":{"docs":{},"p":{"docs":{},"t":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}}}}},"r":{"docs":{},"e":{"docs":{},"d":{"docs":{},"i":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.007017543859649123}}}}}}},"/":{"docs":{},"/":{"docs":{},"为":{"docs":{},"防":{"docs":{},"止":{"docs":{},"锁":{"docs":{},"无":{"docs":{},"法":{"docs":{},"释":{"docs":{},"放":{"docs":{},"，":{"docs":{},"还":{"docs":{},"要":{"docs":{},"设":{"docs":{},"置":{"docs":{},"过":{"docs":{},"期":{"docs":{},"时":{"docs":{},"间":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.007017543859649123}}}}}}}}}}}}}}}}}}},"分":{"docs":{},"配":{"docs":{},"一":{"docs":{},"个":{"docs":{},"随":{"docs":{},"机":{"docs":{},"的":{"docs":{},"值":{"docs":{},"针":{"docs":{},"对":{"docs":{},"问":{"docs":{},"题":{"3":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}},"docs":{}}}}}}}}}}}}},"删":{"docs":{},"除":{"docs":{},"r":{"docs":{},"e":{"docs":{},"d":{"docs":{},"i":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.007017543859649123}}}}}},"锁":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}},"判":{"docs":{},"断":{"docs":{},"是":{"docs":{},"自":{"docs":{},"己":{"docs":{},"的":{"docs":{},"锁":{"docs":{},"，":{"docs":{},"再":{"docs":{},"删":{"docs":{},"除":{"docs":{},"r":{"docs":{},"e":{"docs":{},"d":{"docs":{},"i":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}}}}}}}}}}}}}},"加":{"docs":{},"锁":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}},"如":{"docs":{},"果":{"docs":{},"是":{"docs":{},"两":{"docs":{},"次":{"docs":{},"值":{"docs":{},"不":{"docs":{},"同":{"docs":{},"，":{"docs":{},"说":{"docs":{},"明":{"docs":{},"a":{"docs":{},"请":{"docs":{},"示":{"docs":{},"的":{"docs":{},"业":{"docs":{},"务":{"docs":{},"还":{"docs":{},"未":{"docs":{},"处":{"docs":{},"理":{"docs":{},"完":{"docs":{},"，":{"docs":{},"$":{"docs":{},"k":{"docs":{},"e":{"docs":{},"y":{"docs":{},"超":{"docs":{},"时":{"docs":{},"，":{"docs":{},"b":{"docs":{},"进":{"docs":{},"来":{"docs":{},"了":{"docs":{},"，":{"docs":{},"此":{"docs":{},"时":{"docs":{},"把":{"docs":{},"$":{"docs":{},"i":{"docs":{},"s":{"docs":{},"l":{"docs":{},"o":{"docs":{},"c":{"docs":{},"k":{"docs":{},"设":{"docs":{},"置":{"docs":{},"为":{"docs":{},"f":{"docs":{},"a":{"docs":{},"l":{"docs":{},"s":{"docs":{},"e":{"docs":{},"，":{"docs":{},"一":{"docs":{},"段":{"docs":{},"时":{"docs":{},"间":{"docs":{},"后":{"docs":{},"重":{"docs":{},"新":{"docs":{},"请":{"docs":{},"求":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}},"开":{"docs":{},"始":{"docs":{},"进":{"docs":{},"行":{"docs":{},"业":{"docs":{},"务":{"docs":{},"逻":{"docs":{},"辑":{"docs":{},"处":{"docs":{},"理":{"docs":{},".":{"docs":{},".":{"docs":{},".":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.007017543859649123}}}}}}}}}}}}}}},"异":{"docs":{},"常":{"docs":{},"处":{"docs":{},"理":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.014035087719298246}}}}}},"执":{"docs":{},"行":{"docs":{},"业":{"docs":{},"务":{"docs":{},"代":{"docs":{},"码":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}}}}},"睡":{"docs":{},"眠":{"docs":{},"，":{"docs":{},"降":{"docs":{},"低":{"docs":{},"抢":{"docs":{},"锁":{"docs":{},"频":{"docs":{},"率":{"docs":{},"，":{"docs":{},"缓":{"docs":{},"解":{"docs":{},"r":{"docs":{},"e":{"docs":{},"d":{"docs":{},"i":{"docs":{},"s":{"docs":{},"压":{"docs":{},"力":{"docs":{},"，":{"docs":{},"针":{"docs":{},"对":{"docs":{},"问":{"docs":{},"题":{"2":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}},"docs":{}}}}}}}}}}}}}}}}}}}}}}}}},"进":{"docs":{},"行":{"docs":{},"业":{"docs":{},"务":{"docs":{},"逻":{"docs":{},"辑":{"docs":{},"处":{"docs":{},"理":{"docs":{},".":{"docs":{},".":{"docs":{},".":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.007017543859649123}}}}}}}}}}}}},"针":{"docs":{},"对":{"docs":{},"问":{"docs":{},"题":{"1":{"docs":{},"，":{"docs":{},"使":{"docs":{},"用":{"docs":{},"循":{"docs":{},"环":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}}}}},"docs":{}}}}},"防":{"docs":{},"止":{"docs":{},"提":{"docs":{},"前":{"docs":{},"过":{"docs":{},"期":{"docs":{},"，":{"docs":{},"误":{"docs":{},"删":{"docs":{},"其":{"docs":{},"它":{"docs":{},"请":{"docs":{},"求":{"docs":{},"创":{"docs":{},"建":{"docs":{},"的":{"docs":{},"锁":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.007017543859649123}}}}}}}}}}}}}}}}}}}}},"=":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.06666666666666667}},"=":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.010526315789473684}}},">":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.017543859649122806}}}},">":{"docs":{},"d":{"docs":{},"e":{"docs":{},"l":{"docs":{},"(":{"docs":{},"$":{"docs":{},"k":{"docs":{},"e":{"docs":{},"y":{"docs":{},")":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.014035087719298246}},";":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}}}}}}}}},"e":{"docs":{},"x":{"docs":{},"p":{"docs":{},"i":{"docs":{},"r":{"docs":{},"e":{"docs":{},"(":{"docs":{},"$":{"docs":{},"k":{"docs":{},"e":{"docs":{},"y":{"docs":{},",":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.007017543859649123}}}}}}}}}}}}}},"g":{"docs":{},"e":{"docs":{},"t":{"docs":{},"(":{"docs":{},"$":{"docs":{},"k":{"docs":{},"e":{"docs":{},"y":{"docs":{},")":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.007017543859649123}},")":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}}}}}}}}},"i":{"docs":{},"n":{"docs":{},"c":{"docs":{},"r":{"docs":{},"(":{"docs":{},"$":{"docs":{},"k":{"docs":{},"e":{"docs":{},"y":{"docs":{},")":{"docs":{},">":{"1":{"docs":{},")":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}},"docs":{}}}}}}}}}}}},"l":{"docs":{},"o":{"docs":{},"c":{"docs":{},"k":{"docs":{},"(":{"docs":{},"'":{"docs":{},"m":{"docs":{},"y":{"docs":{},"_":{"docs":{},"r":{"docs":{},"e":{"docs":{},"s":{"docs":{},"o":{"docs":{},"u":{"docs":{},"r":{"docs":{},"c":{"docs":{},"e":{"docs":{},"_":{"docs":{},"n":{"docs":{},"a":{"docs":{},"m":{"docs":{},"e":{"docs":{},"'":{"docs":{},",":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}}}}}}}}}}}}}}}}}}}}}}},"s":{"docs":{},"e":{"docs":{},"t":{"docs":{},"(":{"docs":{},"$":{"docs":{},"k":{"docs":{},"e":{"docs":{},"y":{"docs":{},",":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.010526315789473684}}}}}}}},"n":{"docs":{},"x":{"docs":{},"(":{"docs":{},"$":{"docs":{},"k":{"docs":{},"e":{"docs":{},"y":{"docs":{},",":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}}}}}}}}}},"u":{"docs":{},"n":{"docs":{},"l":{"docs":{},"o":{"docs":{},"c":{"docs":{},"k":{"docs":{},"(":{"docs":{},"$":{"docs":{},"l":{"docs":{},"o":{"docs":{},"c":{"docs":{},"k":{"docs":{},")":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}}}}}}}}}}}}},"[":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}},"'":{"1":{"2":{"7":{"docs":{},".":{"0":{"docs":{},".":{"0":{"docs":{},".":{"1":{"docs":{},"'":{"docs":{},",":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.010526315789473684}}}}},"docs":{}}},"docs":{}}},"docs":{}}},"docs":{}},"docs":{}},"docs":{}}},"]":{"docs":{},";":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}},"a":{"docs":{},"r":{"docs":{},"r":{"docs":{},"a":{"docs":{},"y":{"docs":{},"(":{"docs":{},"'":{"docs":{},"n":{"docs":{},"x":{"docs":{},"'":{"docs":{},",":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.017543859649122806}}}}}}}}}}}}},"c":{"docs":{},"a":{"docs":{},"c":{"docs":{},"h":{"docs":{},"e":{"docs":{},"(":{"docs":{},"e":{"docs":{},"x":{"docs":{},"c":{"docs":{},"e":{"docs":{},"p":{"docs":{},"t":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.014035087719298246}}}}}}}}}}}},"t":{"docs":{},"c":{"docs":{},"h":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}}},"o":{"docs":{},"n":{"docs":{},"t":{"docs":{},"i":{"docs":{},"n":{"docs":{},"u":{"docs":{},"e":{"docs":{},";":{"docs":{},"/":{"docs":{},"/":{"docs":{},"执":{"docs":{},"行":{"docs":{},"成":{"docs":{},"功":{"docs":{},"删":{"docs":{},"除":{"docs":{},"k":{"docs":{},"e":{"docs":{},"y":{"docs":{},"并":{"docs":{},"跳":{"docs":{},"出":{"docs":{},"循":{"docs":{},"环":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}}}}}}}}}}}}}}}}}}}}}}}},"f":{"docs":{},"a":{"docs":{},"l":{"docs":{},"s":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}},"i":{"docs":{},"n":{"docs":{},"a":{"docs":{},"l":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.014035087719298246}},"l":{"docs":{},"y":{"docs":{},"{":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}}}}}},"u":{"docs":{},"n":{"docs":{},"c":{"docs":{},"t":{"docs":{},"i":{"docs":{},"o":{"docs":{},"n":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.014035087719298246}}}}}}}}}},"k":{"docs":{},"e":{"docs":{},"y":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.010526315789473684}}}}},"n":{"docs":{},"e":{"docs":{},"w":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}},"p":{"docs":{},"u":{"docs":{},"b":{"docs":{},"l":{"docs":{},"i":{"docs":{},"c":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.014035087719298246}}}}}}}},"r":{"docs":{},"e":{"docs":{},"d":{"docs":{},"i":{"docs":{},"s":{"docs":{},"发":{"docs":{},"现":{"docs":{},"锁":{"docs":{},"失":{"docs":{},"败":{"docs":{},"了":{"docs":{},"要":{"docs":{},"怎":{"docs":{},"么":{"docs":{},"办":{"docs":{},"？":{"docs":{},"中":{"docs":{},"断":{"docs":{},"请":{"docs":{},"求":{"docs":{},"还":{"docs":{},"是":{"docs":{},"循":{"docs":{},"环":{"docs":{},"请":{"docs":{},"求":{"docs":{},"？":{"2":{"docs":{},"、":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}},"docs":{}}}}}}}}}}}}}}}}}}}}}}},"锁":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":10.003508771929825}}}}},"l":{"docs":{},"o":{"docs":{},"c":{"docs":{},"k":{"docs":{},"(":{"docs":{},"$":{"docs":{},"s":{"docs":{},"e":{"docs":{},"r":{"docs":{},"v":{"docs":{},"e":{"docs":{},"r":{"docs":{},"s":{"docs":{},")":{"docs":{},";":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}}}}}}}}}}}}}}},"t":{"docs":{},"u":{"docs":{},"r":{"docs":{},"n":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.014035087719298246}}}}}}}},"s":{"docs":{},"l":{"docs":{},"e":{"docs":{},"e":{"docs":{},"p":{"docs":{},"(":{"docs":{},"$":{"docs":{},"s":{"docs":{},"l":{"docs":{},"e":{"docs":{},"e":{"docs":{},"p":{"docs":{},"t":{"docs":{},"i":{"docs":{},"m":{"docs":{},"e":{"docs":{},")":{"docs":{},"/":{"docs":{},"/":{"docs":{},"睡":{"docs":{},"眠":{"docs":{},"后":{"docs":{},"重":{"docs":{},"新":{"docs":{},"请":{"docs":{},"求":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}}}}}}}}}}}}}}}}}}}}}}}}},"t":{"docs":{},"e":{"docs":{},"s":{"docs":{},"t":{"docs":{},"r":{"docs":{},"e":{"docs":{},"d":{"docs":{},"i":{"docs":{},"s":{"docs":{},"l":{"docs":{},"o":{"docs":{},"c":{"docs":{},"k":{"docs":{},"(":{"docs":{},")":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.014035087719298246}}}}}}}}}}}}}}}},"r":{"docs":{},"i":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}},"y":{"docs":{},"{":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.014035087719298246}}}}}},"u":{"docs":{},"s":{"docs":{},"l":{"docs":{},"e":{"docs":{},"e":{"docs":{},"p":{"docs":{},"(":{"5":{"0":{"0":{"0":{"docs":{},")":{"docs":{},";":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}},"docs":{}},"docs":{}},"docs":{}},"docs":{}}}}}}},"u":{"docs":{},"i":{"docs":{},"d":{"docs":{},"(":{"docs":{},")":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}}}}},"v":{"docs":{},"a":{"docs":{},"l":{"docs":{},"u":{"docs":{},"e":{"docs":{},")":{"docs":{},"方":{"docs":{},"式":{"docs":{},"，":{"docs":{},"如":{"docs":{},"果":{"docs":{},"值":{"docs":{},"不":{"docs":{},"存":{"docs":{},"在":{"docs":{},"，":{"docs":{},"则":{"docs":{},"反":{"docs":{},"回":{"1":{"docs":{},",":{"docs":{},"如":{"docs":{},"果":{"docs":{},"存":{"docs":{},"在":{"docs":{},"，":{"docs":{},"则":{"docs":{},"反":{"docs":{},"回":{"0":{"docs":{},"，":{"docs":{},"为":{"docs":{},"避":{"docs":{},"免":{"docs":{},"锁":{"docs":{},"不":{"docs":{},"释":{"docs":{},"放":{"docs":{},"，":{"docs":{},"仍":{"docs":{},"需":{"docs":{},"要":{"docs":{},"设":{"docs":{},"置":{"docs":{},"过":{"docs":{},"期":{"docs":{},"时":{"docs":{},"间":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}}}}}}}}}}}}}}}}}},"docs":{}}}}}}}}}}},"docs":{}}}}}}}}}}}}}}}}}}}},"w":{"docs":{},"h":{"docs":{},"i":{"docs":{},"l":{"docs":{},"e":{"docs":{},"(":{"docs":{},"!":{"docs":{},"$":{"docs":{},"i":{"docs":{},"s":{"docs":{},"l":{"docs":{},"o":{"docs":{},"c":{"docs":{},"k":{"docs":{},")":{"docs":{},";":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}}}}}}}}}}}}}}},"{":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.07368421052631578}},"/":{"docs":{},"/":{"docs":{},"大":{"docs":{},"于":{"1":{"docs":{},"表":{"docs":{},"示":{"docs":{},"，":{"docs":{},"已":{"docs":{},"加":{"docs":{},"锁":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}}}}}},"docs":{}}},"未":{"docs":{},"设":{"docs":{},"置":{"docs":{},"成":{"docs":{},"功":{"docs":{},"，":{"docs":{},"则":{"docs":{},"反":{"docs":{},"回":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.010526315789473684}}}}}}}}}}}}}},"}":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.10526315789473684}}},"主":{"docs":{},"从":{"docs":{},"结":{"docs":{},"构":{"docs":{},"，":{"docs":{},"如":{"docs":{},"果":{"docs":{},"r":{"docs":{},"e":{"docs":{},"d":{"docs":{},"i":{"docs":{},"s":{"docs":{},"主":{"docs":{},"服":{"docs":{},"务":{"docs":{},"器":{"docs":{},"已":{"docs":{},"接":{"docs":{},"收":{"docs":{},"到":{"docs":{},"锁":{"docs":{},"，":{"docs":{},"但":{"docs":{},"在":{"docs":{},"同":{"docs":{},"步":{"docs":{},"从":{"docs":{},"服":{"docs":{},"务":{"docs":{},"时":{"docs":{},"崩":{"docs":{},"溃":{"docs":{},"，":{"docs":{},"此":{"docs":{},"时":{"docs":{},"如":{"docs":{},"何":{"docs":{},"处":{"docs":{},"理":{"docs":{},"？":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}},"仍":{"docs":{},"使":{"docs":{},"用":{"docs":{},"r":{"docs":{},"e":{"docs":{},"d":{"docs":{},"i":{"docs":{},"s":{"docs":{},"的":{"docs":{},"s":{"docs":{},"e":{"docs":{},"t":{"docs":{},"(":{"docs":{},"$":{"docs":{},"k":{"docs":{},"e":{"docs":{},"y":{"docs":{},",":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}}}}}}}}}}}}}}}},"存":{"docs":{},"在":{"docs":{},"的":{"docs":{},"问":{"docs":{},"题":{"docs":{},"r":{"docs":{},"e":{"docs":{},"d":{"docs":{},"i":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}}}}}}}}},"使":{"docs":{},"用":{"docs":{},"r":{"docs":{},"e":{"docs":{},"d":{"docs":{},"i":{"docs":{},"s":{"docs":{},"的":{"docs":{},"i":{"docs":{},"n":{"docs":{},"c":{"docs":{},"r":{"docs":{},"函":{"docs":{},"数":{"docs":{},"，":{"docs":{},"每":{"docs":{},"次":{"docs":{},"调":{"docs":{},"用":{"docs":{},"此":{"docs":{},"函":{"docs":{},"数":{"docs":{},"时":{"docs":{},"，":{"docs":{},"如":{"docs":{},"果":{"docs":{},"反":{"docs":{},"回":{"docs":{},"值":{"docs":{},"大":{"docs":{},"于":{"1":{"docs":{},"，":{"docs":{},"则":{"docs":{},"表":{"docs":{},"示":{"docs":{},"此":{"docs":{},"锁":{"docs":{},"正":{"docs":{},"在":{"docs":{},"使":{"docs":{},"用":{"docs":{},"中":{"docs":{},"，":{"docs":{},"从":{"docs":{},"而":{"docs":{},"实":{"docs":{},"现":{"docs":{},"加":{"docs":{},"锁":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}}}}}}}}}}}}}}}}}},"docs":{}}}}}}}}}}}}}}}}}}}}}}}},"s":{"docs":{},"e":{"docs":{},"t":{"docs":{},"(":{"docs":{},"$":{"docs":{},"k":{"docs":{},"e":{"docs":{},"y":{"docs":{},",":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}}}}},"n":{"docs":{},"x":{"docs":{},"(":{"docs":{},"k":{"docs":{},"e":{"docs":{},"y":{"docs":{},",":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}}}}}}}}}}}}}}}}},"官":{"docs":{},"方":{"docs":{},"提":{"docs":{},"供":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}}},"循":{"docs":{},"环":{"docs":{},"请":{"docs":{},"求":{"docs":{},"的":{"docs":{},"话":{"docs":{},"，":{"docs":{},"如":{"docs":{},"果":{"docs":{},"有":{"docs":{},"一":{"docs":{},"个":{"docs":{},"获":{"docs":{},"取":{"docs":{},"了":{"docs":{},"锁":{"docs":{},"，":{"docs":{},"其":{"docs":{},"它":{"docs":{},"的":{"docs":{},"在":{"docs":{},"去":{"docs":{},"获":{"docs":{},"取":{"docs":{},"锁":{"docs":{},"的":{"docs":{},"时":{"docs":{},"候":{"docs":{},"，":{"docs":{},"是":{"docs":{},"不":{"docs":{},"是":{"docs":{},"容":{"docs":{},"易":{"docs":{},"发":{"docs":{},"生":{"docs":{},"抢":{"docs":{},"锁":{"docs":{},"的":{"docs":{},"可":{"docs":{},"能":{"docs":{},"？":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}},"秒":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}},"第":{"docs":{},"一":{"docs":{},"种":{"docs":{},"方":{"docs":{},"式":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}}},"三":{"docs":{},"种":{"docs":{},"方":{"docs":{},"式":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}}},"二":{"docs":{},"种":{"docs":{},"方":{"docs":{},"式":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}}},"五":{"docs":{},"种":{"docs":{},"方":{"docs":{},"式":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}}},"四":{"docs":{},"种":{"docs":{},"方":{"docs":{},"式":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}}}},"缺":{"docs":{},"点":{"docs":{},"：":{"docs":{},"破":{"docs":{},"坏":{"docs":{},"原":{"docs":{},"子":{"docs":{},"性":{"docs":{},"操":{"docs":{},"作":{"docs":{},"，":{"docs":{},"上":{"docs":{},"锁":{"docs":{},"机":{"docs":{},"制":{"docs":{},"，":{"docs":{},"与":{"docs":{},"设":{"docs":{},"置":{"docs":{},"过":{"docs":{},"期":{"docs":{},"时":{"docs":{},"间":{"docs":{},"，":{"docs":{},"是":{"docs":{},"分":{"docs":{},"开":{"docs":{},"的":{"docs":{},"，":{"docs":{},"这":{"docs":{},"中":{"docs":{},"间":{"docs":{},"如":{"docs":{},"果":{"docs":{},"服":{"docs":{},"务":{"docs":{},"器":{"docs":{},"宕":{"docs":{},"机":{"docs":{},"或":{"docs":{},"者":{"docs":{},"其":{"docs":{},"它":{"docs":{},"故":{"docs":{},"障":{"docs":{},"，":{"docs":{},"会":{"docs":{},"造":{"docs":{},"成":{"docs":{},"锁":{"docs":{},"无":{"docs":{},"法":{"docs":{},"释":{"docs":{},"放":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.007017543859649123}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}},"设":{"docs":{},"置":{"docs":{},"的":{"docs":{},"过":{"docs":{},"期":{"docs":{},"时":{"docs":{},"间":{"docs":{},"为":{"docs":{},"t":{"docs":{},"t":{"docs":{},"l":{"docs":{},"，":{"docs":{},"如":{"docs":{},"果":{"docs":{},"t":{"docs":{},"t":{"docs":{},"l":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}}}}}}}}}}}}}}}}}}},"要":{"docs":{},"解":{"docs":{},"决":{"docs":{},"的":{"docs":{},"问":{"docs":{},"题":{"docs":{},"是":{"docs":{},"，":{"docs":{},"避":{"docs":{},"免":{"docs":{},"业":{"docs":{},"务":{"docs":{},"逻":{"docs":{},"辑":{"docs":{},"中":{"docs":{},"对":{"docs":{},"数":{"docs":{},"据":{"docs":{},"重":{"docs":{},"复":{"docs":{},"处":{"docs":{},"理":{"docs":{},"。":{"docs":{},"本":{"docs":{},"文":{"docs":{},"所":{"docs":{},"有":{"docs":{},"代":{"docs":{},"码":{"docs":{},"均":{"docs":{},"为":{"docs":{},"伪":{"docs":{},"代":{"docs":{},"码":{"docs":{},"，":{"docs":{},"只":{"docs":{},"考":{"docs":{},"虑":{"docs":{},"业":{"docs":{},"务":{"docs":{},"逻":{"docs":{},"辑":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}},"解":{"docs":{},"释":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}},"针":{"docs":{},"对":{"docs":{},"问":{"docs":{},"题":{"1":{"docs":{},"：":{"docs":{},"使":{"docs":{},"用":{"docs":{},"循":{"docs":{},"环":{"docs":{},"请":{"docs":{},"求":{"docs":{},"，":{"docs":{},"循":{"docs":{},"环":{"docs":{},"请":{"docs":{},"求":{"docs":{},"去":{"docs":{},"获":{"docs":{},"取":{"docs":{},"锁":{"docs":{},"针":{"docs":{},"对":{"docs":{},"问":{"docs":{},"题":{"2":{"docs":{},"：":{"docs":{},"针":{"docs":{},"对":{"docs":{},"第":{"docs":{},"二":{"docs":{},"个":{"docs":{},"问":{"docs":{},"题":{"docs":{},"，":{"docs":{},"在":{"docs":{},"循":{"docs":{},"环":{"docs":{},"请":{"docs":{},"求":{"docs":{},"获":{"docs":{},"取":{"docs":{},"锁":{"docs":{},"的":{"docs":{},"时":{"docs":{},"候":{"docs":{},"，":{"docs":{},"加":{"docs":{},"入":{"docs":{},"睡":{"docs":{},"眠":{"docs":{},"功":{"docs":{},"能":{"docs":{},"，":{"docs":{},"等":{"docs":{},"待":{"docs":{},"几":{"docs":{},"毫":{"docs":{},"秒":{"docs":{},"在":{"docs":{},"执":{"docs":{},"行":{"docs":{},"循":{"docs":{},"环":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}},"docs":{}}}}}}}}}}}}}}}}}}}}}},"docs":{}}}}},"问":{"docs":{},"题":{"docs":{},":":{"1":{"docs":{},"、":{"docs":{"docs/redisLock.html":{"ref":"docs/redisLock.html","tf":0.0035087719298245615}}}},"docs":{}}}}},"length":120},"corpusTokens":["\"productid\"","\"productid\"//此值，应该是业务过来的某个值","#1进入关键业务逻辑，加锁","$e)","$islock","$key","$lock","$redi","$redlock","$roomid","$server","$sleeptim","$ttl","$ttl)","$ttl)))","$ttl));//ex","$ttl))方式，本方法就是setnx加了个过期时间，但是原子操作","$valu","$value)","$value,","'ex'","'room_'.$roomid;","'room_lock';","(!$redi","($islock)","($redi","($valu","(except","(redi","//为防止锁无法释放，还要设置过期时间","//分配一个随机的值针对问题3","//删除redi","//删除锁","//判断是自己的锁，再删除redi","//加锁","//如果是两次值不同，说明a请示的业务还未处理完，$key超时，b进来了，此时把$islock设置为false，一段时间后重新请求","//开始进行业务逻辑处理...","//异常处理","//执行业务代码","//睡眠，降低抢锁频率，缓解redis压力，针对问题2","//进行业务逻辑处理...","//针对问题1，使用循环","//防止提前过期，误删其它请求创建的锁","0.01],","1))","1000);","1000//此值应该取一个递增值","10001;","10;","30","6379,","6389,","6399,","=","==","=>",">del($key)",">del($key);",">expire($key,",">get($key)",">get($key))",">incr($key)>1)",">lock('my_resource_name',",">set($key,",">setnx($key,",">unlock($lock)","[","['127.0.0.1',","];","array('nx',","cache(except","catch","continue;//执行成功删除key并跳出循环","fals","final","finally{","function","introduct","key","new","public","redis发现锁失败了要怎么办？中断请求还是循环请求？2、","redis锁","redlock($servers);","return","sleep($sleeptime)//睡眠后重新请求","testredislock()","tri","try{","usleep(5000);","uuid()","value)方式，如果值不存在，则反回1,如果存在，则反回0，为避免锁不释放，仍需要设置过期时间","while(!$islock);","{","{//大于1表示，已加锁","{//未设置成功，则反回","}","主从结构，如果redis主服务器已接收到锁，但在同步从服务时崩溃，此时如何处理？","仍使用redis的set($key,","仍存在的问题redi","使用redis的incr函数，每次调用此函数时，如果反回值大于1，则表示此锁正在使用中，从而实现加锁","使用redis的set($key,","使用redis的setnx(key,","官方提供","常用知识点","循环请求的话，如果有一个获取了锁，其它的在去获取锁的时候，是不是容易发生抢锁的可能？","文档内容介绍","本目录下记录一些散乱知识点","秒","第一种方式","第三种方式","第二种方式","第五种方式","第四种方式","缺点：破坏原子性操作，上锁机制，与设置过期时间，是分开的，这中间如果服务器宕机或者其它故障，会造成锁无法释放","缺点：设置的过期时间为ttl，如果ttl","要解决的问题是，避免业务逻辑中对数据重复处理。本文所有代码均为伪代码，只考虑业务逻辑","解释","针对问题1：使用循环请求，循环请求去获取锁针对问题2：针对第二个问题，在循环请求获取锁的时候，加入睡眠功能，等待几毫秒在执行循环","问题:1、"],"pipeline":["stopWordFilter","stemmer"]},"store":{"./":{"url":"./","title":"Introduction","keywords":"","body":"Introduction\n文档内容介绍\n"},"docs/":{"url":"docs/","title":"常用知识点","keywords":"","body":"本目录下记录一些散乱知识点\n"},"docs/redisLock.html":{"url":"docs/redisLock.html","title":"Redis锁","keywords":"","body":"redis锁\n要解决的问题是，避免业务逻辑中对数据重复处理。本文所有代码均为伪代码，只考虑业务逻辑\n第一种方式\n使用redis的incr函数，每次调用此函数时，如果反回值大于1，则表示此锁正在使用中，从而实现加锁\npublic function testRedisLock()\n{\n    #1进入关键业务逻辑，加锁\n    $key = \"productId\"\n    $ttl = 30\n\n    try{\n        if ($redis->incr($key)>1) {//大于1表示，已加锁\n            return\n        }\n        //为防止锁无法释放，还要设置过期时间\n        $redis->expire($key, $ttl)\n        //进行业务逻辑处理...\n\n    } cache(Exception $e) {\n        //异常处理\n    } finally {\n        $redis->del($key)\n    }\n\n}\n缺点：破坏原子性操作，上锁机制，与设置过期时间，是分开的，这中间如果服务器宕机或者其它故障，会造成锁无法释放\n第二种方式\n使用redis的setnx(key, value)方式，如果值不存在，则反回1,如果存在，则反回0，为避免锁不释放，仍需要设置过期时间\npublic function testRedisLock()\n{\n    #1进入关键业务逻辑，加锁\n    $key = \"productId\"\n    $ttl = 30\n\n    try{\n        if (!$redis->setnx($key, 1)) {//未设置成功，则反回\n            return\n        }\n        //为防止锁无法释放，还要设置过期时间\n        $redis->expire($key, $ttl)\n        //进行业务逻辑处理...\n\n    } cache(Exception $e) {\n        //异常处理\n    } finally {\n        //删除redis key\n        $redis->del($key)\n    }\n\n}\n缺点：破坏原子性操作，上锁机制，与设置过期时间，是分开的，这中间如果服务器宕机或者其它故障，会造成锁无法释放\n第三种方式\n使用redis的set($key, $value, array('nx', 'ex' => $ttl))方式，本方法就是setnx加了个过期时间，但是原子操作\npublic function testRedisLock()\n{\n    #1进入关键业务逻辑，加锁\n    $key = \"productId\"//此值，应该是业务过来的某个值\n    $ttl = 30\n\n    try{\n        if (!$redis->set($key, $value, array('nx', 'ex' => $ttl))) {//未设置成功，则反回\n            return\n        }\n        //开始进行业务逻辑处理...\n\n    } cache(Exception $e) {\n        //异常处理\n    } finally {\n        //删除redis key\n        $redis->del($key)\n    }\n}\n缺点：设置的过期时间为ttl，如果ttl\n第四种方式\n仍使用redis的set($key, $value, array('nx', 'ex' => $ttl))方式，本方法就是setnx加了个过期时间，但是原子操作\npublic function testRedisLock()\n{\n    #1进入关键业务逻辑，加锁\n    $key = \"productId\"//此值，应该是业务过来的某个值\n    $ttl = 30\n\n    $value = uuid()\n\n    try{\n        if (!$redis->set($key, $value, array('nx', 'ex' => $ttl))) {//未设置成功，则反回\n            return\n        }\n        //开始进行业务逻辑处理...\n\n    } cache(Exception $e) {\n        //异常处理\n    } finally {\n        //判断是自己的锁，再删除redis key\n        if ($value == $redis->get($key)) {\n            $redis->del($key)\n        }\n    }\n}\n问题:1、 redis发现锁失败了要怎么办？中断请求还是循环请求？2、 循环请求的话，如果有一个获取了锁，其它的在去获取锁的时候，是不是容易发生抢锁的可能？  \n第五种方式\n针对问题1：使用循环请求，循环请求去获取锁针对问题2：针对第二个问题，在循环请求获取锁的时候，加入睡眠功能，等待几毫秒在执行循环  \ntry {\n    do {  //针对问题1，使用循环\n        $ttl = 10;\n        $roomid = 10001;\n        $key = 'room_lock';\n        $value = 'room_'.$roomid;  //分配一个随机的值针对问题3\n        $isLock = $redis->set($key, $value, array('nx', 'ex' => $ttl));//ex 秒\n        if ($isLock) {\n            if (redis->get($key) == $value) {  //防止提前过期，误删其它请求创建的锁\n                //执行业务代码\n                continue;//执行成功删除key并跳出循环\n            } else {\n                //如果是两次值不同，说明A请示的业务还未处理完，$key超时，B进来了，此时把$isLock设置为false，一段时间后重新请求\n                $sleepTime = 1000//此值应该取一个递增值\n                $isLock = false \n                sleep($sleepTime)//睡眠后重新请求\n            }\n        } else {\n            usleep(5000); //睡眠，降低抢锁频率，缓解redis压力，针对问题2\n        }\n    } while(!$isLock);\n} catch (Exception $e) {\n\n} finally{\n    if (redis->get($key) == $value) {  //防止提前过期，误删其它请求创建的锁\n        $redis->del($key);\n    }\n}\n仍存在的问题redis 主从结构，如果redis主服务器已接收到锁，但在同步从服务时崩溃，此时如何处理？\n官方提供\n解释\n$servers = [\n    ['127.0.0.1', 6379, 0.01],\n    ['127.0.0.1', 6389, 0.01],\n    ['127.0.0.1', 6399, 0.01],\n];\n\n$redLock = new RedLock($servers);\n\n//加锁\n$lock = $redLock->lock('my_resource_name', 1000);\n\n//删除锁\n$redLock->unlock($lock)\n"}}}